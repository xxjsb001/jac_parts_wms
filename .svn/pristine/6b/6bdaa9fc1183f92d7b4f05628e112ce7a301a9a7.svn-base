package com.vtradex.wms.server.telnet.shell.receiving;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.vtradex.kangaroo.shell.PageableBaseShell;
import com.vtradex.wms.server.model.receiving.WmsASNStatus;
import com.vtradex.wms.server.web.filter.WmsWarehouseHolder;

/**
 * 
 * @category Shell
 * @author <a href="brofe.pan@gmail.com">潘宁波</a>
 * @version $Revision: 1.1.1.1 $Date: 2015/03/25 02:48:55 $
 */
public class WmsASNListShell extends PageableBaseShell {
	
	public static final String PAGE_ID = "wmsASNListShell";

	@Override
	public String[] getTableHeader() {
		return new String[]{"序号", "物料编码/物料名称/期待数量/收货数量"};
	}

	@Override
	public String getHql() {
		String hql = "select a.id, a.item.code || '/' ||a.item.name|| '/' || a.expectedQuantityBU || '/' || a.receivedQuantityBU "+ 
				" from WmsASNDetail a where 1=1 and (a.expectedQuantityBU- a.receivedQuantityBU)>0" +
				" /~状态: AND a.asn.status not in  ({状态})~/" +
				" /~仓库: AND a.asn.warehouse.id = {仓库}~/" +
				" /~收货单号: AND a.asn.code = {收货单号}~/";
		return hql;
	}

	@Override
	public String getNextShell() {
		Object[] rowData = (Object[])get(ROW_DATA_KEY);
		this.put("detail.id", rowData[0]);
		this.put("lotRule.soi", this.getParentContext().get("lotRule.soi").toString());
		return WmsAsnDetailReceiveShell.PAGE_ID;
	}

	@Override
	public Map<String, Object> getParams() {
		Map<String, Object> params = new HashMap<String, Object>();
		List<String> status = new ArrayList<String>();
		String asnCode = (String) this.getParentContext().get("lotRule.soi");
		status.add(WmsASNStatus.RECEIVED);
		status.add(WmsASNStatus.CANCELED);
		status.add(WmsASNStatus.OPEN);
		params.put("状态", status);
		params.put("仓库", WmsWarehouseHolder.getWmsWarehouse().getId());
		params.put("收货单号", asnCode);
		return params;
	}

}
