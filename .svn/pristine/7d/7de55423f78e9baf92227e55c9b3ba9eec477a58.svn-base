R101_库位出入锁校验规则()

如果(校验类型  == "所有"){
	$库位定位分类集=默认条件查表("R101_基础数据_库位定位分类表")
	$库位定位分类 = 空
	$是否找到库位定位分类 = "否"
	
	每个($库位定位:$库位定位分类集){
	    $区区间集=分解列表($库位定位.区区间)
	    $区区间对象=赋值($区区间集,"开始值","结束值")	
	    $排区间集=分解列表($库位定位.排区间)
	    $排区间对象=赋值($排区间集,"开始值","结束值")	
	    $列区间集=分解列表($库位定位.列区间)
	    $列区间对象=赋值($列区间集,"开始值","结束值")	
	    $层区间集=分解列表($库位定位.层区间)
	    $层区间对象=赋值($层区间集,"开始值","结束值")
	
	    如果($是否找到库位定位分类 == "否" && 库区 == $库位定位.库区 
	        && 区 >= $区区间对象.开始值 && 区 <= $区区间对象.结束值 
		&& 排 >= $排区间对象.开始值 && 排 <= $排区间对象.结束值 
		&& 列 >= $列区间对象.开始值 && 列 <= $列区间对象.结束值 
		&& 层 >= $层区间对象.开始值 && 层 <= $层区间对象.结束值){
	        $是否找到库位定位分类 = "是"
	        $库位定位分类 = $库位定位
	    }
	}
	如果($库位定位分类 != 空) {
		R101_库位混放类型校验规则()
		R101_库位承载校验规则()
	}
}




库位混放校验(库位,混放类型,货品序号,批次序号){
	$混放是否成立=1
	如果(库位.库存 == 空  || 库位.库存.序号  == 空){
		$混放是否成立 = 1
	}
	每个($临时:库位.库存){
		如果($临时.序号  != 空  && $临时.数量 > 0){
			$混放是否成立 = 0
		}
	}
	如果(混放类型.货品混放 == "是" && 混放类型.存货日期混放 == "是" && 混放类型.SOI混放 == "是"  && 混放类型.供应商混放 == "是" ){
		$混放是否成立 = 1
	}
	如果($混放是否成立 == 0){
		如果(混放类型.货品混放 == "否"){
			$货品不混放=0
			如果(混放类型.存货日期混放 == "是" && 混放类型.SOI混放 == "是"  && 混放类型.供应商混放 == "是" ){
				每个($库存 : 库位.库存){
					如果($库存.货品序号  == 货品序号  && $库存.数量  > 0){
						$货品不混放 = 1
					}
				}
			}
			
			如果($货品不混放 == 0){
				$混放是否成立 = 0
				每个($库存 : 库位.库存){
					如果($库存.货品序号  == 货品序号  && $库存.数量  > 0){
						$混放是否成立 = 1
						$库存批次属性=数据查询("R101_批次属性数据源", "批次序号", $库存.批次序号)
						$上架批次属性=数据查询("R101_批次属性数据源", "批次序号", 批次序号)
						如果(混放类型.存货日期混放  == "否"){
							如果(格式化日期($库存批次属性.存货日期) != 格式化日期($上架批次属性.存货日期)){
								$混放是否成立 = 0
							}
						}
						如果(混放类型.SOI混放  == "否"){
							如果($库存批次属性.收货单号 != $上架批次属性.收货单号){
								$混放是否成立= 0
							}
						}
						
						如果(混放类型.供应商混放  == "否"){
							如果($库存批次属性.供应商 != $上架批次属性.供应商){
								$混放是否成立 = 0
							}
						}
					}
				
				}
			}
			如果($货品不混放  == 1){
				$混放是否成立 = 1
			}
		}
		如果(混放类型.货品混放 == "是"){
			$货品批次相同=1
			每个($库存 : 库位.库存){
				如果($库存.货品序号  == 货品序号  && $库存.数量  > 0){
					$库存批次属性=数据查询("R101_批次属性数据源", "批次序号", $库存.批次序号)
					$上架批次属性=数据查询("R101_批次属性数据源", "批次序号", 批次序号)
					如果(混放类型.存货日期混放  == "否"){
						如果(格式化日期($库存批次属性.存货日期) != 格式化日期($上架批次属性.存货日期)){
							$货品批次相同 = 0
						}
					}
					
					如果(混放类型.SOI混放  == "否"){
						如果($库存批次属性.收货单号 != $上架批次属性.收货单号){
							$货品批次相同 = 0
						}
					}
					如果(混放类型.供应商混放  == "否"){
						如果($库存批次属性.供应商 != $上架批次属性.供应商){
							$货品批次相同 = 0
						}
					}
				}
			}
			如果($货品批次相同 == 1){
				$混放是否成立 = 1
			}
		}
	}
	混放是否成立 = $混放是否成立
}
