库位占比 = 0.0
$库位定位分类集=默认条件查表("R101_基础数据_库位定位分类表")

$库位定位分类 = 空
$是否找到库位定位分类 = "否"
$库满率 = 0.0

$托盘数=托数
$库存件数 = 件数
$库存重量 = 重量
$库存体积 = 体积

每个($库位定位:$库位定位分类集){
    $区区间集=分解列表($库位定位.区区间)
    $区区间对象=赋值($区区间集,"开始值","结束值")	
    $排区间集=分解列表($库位定位.排区间)
    $排区间对象=赋值($排区间集,"开始值","结束值")	
    $列区间集=分解列表($库位定位.列区间)
    $列区间对象=赋值($列区间集,"开始值","结束值")	
    $层区间集=分解列表($库位定位.层区间)
    $层区间对象=赋值($层区间集,"开始值","结束值")

    如果($是否找到库位定位分类 == "否" && 库区 == $库位定位.库区 
        && 区 >= $区区间对象.开始值 && 区 <= $区区间对象.结束值 
	&& 排 >= $排区间对象.开始值 && 排 <= $排区间对象.结束值 
	&& 列 >= $列区间对象.开始值 && 列 <= $列区间对象.结束值 
	&& 层 >= $层区间对象.开始值 && 层 <= $层区间对象.结束值){

        $是否找到库位定位分类 = "是"
        $库位定位分类 = $库位定位
    }
}

如果($库位定位分类 != 空) {
	$库位承载类型结果=查表("R101_基础数据_库位承载类型表",$库位定位分类.库位承载类型)
	如果($库位承载类型结果 == 空){
 		异常("["+$库位承载类型结果.库位承载类型+"]"+"查找[R101_基础数据_库位承载类型表]未找到数据!")
    }

	如果($库位承载类型结果.托数 > 0){  
		$库满率 = $托盘数/$库位承载类型结果.托数*100
    }
           
	如果($库位承载类型结果.托数 == 0){
		如果($库位承载类型结果.重量 == 0 && $库位承载类型结果.体积 == 0 && $库位承载类型结果.件数 == 0){
			$库满率=0.0
        }

 		如果($库位承载类型结果.重量 != 0 || $库位承载类型结果.体积 != 0 || $库位承载类型结果.件数 != 0){
			如果($库位承载类型结果.重量>0){
            	$重量占比 = $库存重量/$库位承载类型结果.重量*100
            }			   
			 如果($库位承载类型结果.体积>0){
            	$体积占比 = $库存体积/$库位承载类型结果.体积*100
            }			   
			如果($库位承载类型结果.件数>0){
                $件数占比 = $库存件数/$库位承载类型结果.件数*100
            }
            $库满率 = 最大($重量占比,$体积占比,$件数占比)
        }
    }                               
}

库位占比 = $库满率
