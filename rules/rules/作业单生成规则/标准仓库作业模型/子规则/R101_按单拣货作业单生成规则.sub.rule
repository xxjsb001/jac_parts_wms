
如果(作业任务集 == 空) {
	异常("移位单号:[" + 移位单号 + "], 作业任务集为空, 查询无数据!")
}

$作业组单 = 查表("R101_按单拣货_作业组单表",仓库)

每个($作业单 : 作业单集){
	如果($作业单.单数 < $作业组单.单数 && $作业单.件数 < $作业组单.件数){
		如果($作业单.重量 < $作业组单.重量 && $作业单.体积 < $作业组单.体积){
			加入列表(返回列表,$作业单)
		}	
	}
}
每个($订单 : 作业任务集.订单){
	$工作区任务列表 = 创建列表()
	
	每个($任务 : $订单.任务) {
		
		$工作区序号 = 获取工作区($任务).工作区序号
		
		$存在标识 = 0
		每个($临时返回对象 : $工作区任务列表) {
			如果($临时返回对象.工作区序号 == $工作区序号) {
				加入列表($临时返回对象.任务集, $任务)
				$存在标识 = 1
			}
		}
		如果($存在标识 == 0) {
			$返回对象 = 创建对象()
			$返回对象.工作区序号 = $工作区序号
			$任务列表 = 创建列表()
			加入列表($任务列表, $任务)
			$返回对象.任务集 = $任务列表
			加入列表($工作区任务列表, $返回对象)
		}
	}
	每个($工作区任务 : $工作区任务列表){
		$加入作业单=空
		每个($作业单 : 返回列表){
			如果($作业单.工作区序号 == $工作区任务.工作区序号){
				如果($作业单.单数 < $作业组单.单数 && $作业单.件数 < $作业组单.件数){
					如果($作业单.重量 < $作业组单.重量 && $作业单.体积 < $作业组单.体积){
						$加入作业单 = $作业单
					}	
				}
				
			}
		}
		如果($加入作业单 == 空){
			$加入作业单 = 创建对象()
			$加入作业单.作业单序号 = 空
			$加入作业单.工作区序号 = $工作区任务.工作区序号
			$加入作业单.单数 = 0
			$加入作业单.件数 = 0
			$加入作业单.重量 = 0
			$加入作业单.体积 = 0
			$加入作业单.任务集 = 创建列表()
			加入列表(返回列表,$加入作业单)
		}
		如果($加入作业单.任务集 == 空){
			$加入作业单.任务集 = 创建列表()
		}
		$加入作业单.单数 = $加入作业单.单数 + 1
		每个($任务 : $工作区任务.任务集){
			$加入作业单.件数 = $加入作业单.件数 + $任务.件数
			$加入作业单.重量 = $加入作业单.重量 + $任务.重量
			$加入作业单.体积 = $加入作业单.体积 + $任务.体积
			加入列表($加入作业单.任务集,$任务)
		}
	}
}

